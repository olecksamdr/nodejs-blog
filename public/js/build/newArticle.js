define("jsmodules/elements/loadImageInput",[],function(){var e=document.getElementById("add-image");return e}),define("jsmodules/imgFunc/addImage",["../elements/loadImageInput"],function(e){function t(t,n){e.click(),e.onchange=function(e){var a=e.target.files,r=a[0],o=new FileReader;o.onload=function(e){t.setAttribute("data-name",r.name),t.setAttribute("src",e.target.result),console.log(t),console.log(e.target.result),n&&n(t,600)},o.readAsDataURL(r)}}return t}),define("jsmodules/subMenu",["./elements/loadImageInput","./imgFunc/addImage"],function(e,t){function n(){function n(n){var r=n.target.parentNode.parentNode.parentNode,o=r.nextSibling,s=d();o?o.insertBefore(s.cont,o.firstChild):insertAfter(s.cont,r),t(e,s.img),a.hide()}function r(e){var t=e.target.parentNode.parentNode.parentNode,n=t.nextSibling,r=c();n?t.parentNode.insertBefore(r.cont,n):insertAfter(r.cont,t),a.hide()}function o(e){var t=e.target.parentNode.parentNode.parentNode,n=t.nextSibling,r=c();r.p.className="selected",n?t.parentNode.insertBefore(r.cont,n):insertAfter(r.cont,t),a.hide}function s(e){var t=e.target.parentNode.parentNode.parentNode,n=t.nextSibling,r=u();n?t.parentNode.insertBefore(r,n):insertAfter(r,t),a.hide}function i(e){var t=e.target.parentNode.parentNode.parentNode,n=t.nextSibling;N.onclick=function(e){y.className="pop-up pop-up-disappear",setTimeout(function(){y.style.display="none"},380);var a=l(E.value),r=m(a);n?t.parentNode.insertBefore(r,n):insertAfter(vide,t)},a.hide(),y.style.display="block",y.className="pop-up pop-up-appear"}function l(e){return e.replace("watch?v=","embed/").replace("&","?")}function d(){var e=document.createElement("div");e.className="img-container left";var t=e.cloneNode();t.className="arrLeft rm";var n=e.cloneNode();n.className="arrCenter rm";var a=e.cloneNode();a.className="arrRight rm";var r=document.createElement("img"),o=e.cloneNode();o.className="resize rm";var s=e.cloneNode();s.className="add rm";var i=e.cloneNode();return i.className="delete rm",e.appendChild(t),e.appendChild(n),e.appendChild(a),e.appendChild(r),e.appendChild(o),e.appendChild(s),e.appendChild(i),{cont:e,img:r}}function c(){var e=document.createElement("div");e.className="container";var t=document.createElement("p");t.innerHTML="Новий параграф";var n=e.cloneNode();n.className="delete rm";var a=e.cloneNode();return a.className="plusA rm",e.appendChild(t),e.appendChild(n),e.appendChild(a),{cont:e,p:t}}function u(){var e=document.createElement("div");e.className="container";var t=document.createElement("pre"),n=document.createElement("code");n.className="language-html",n.setAttribute("contenteditable",!0),n.innerHTML="// html\nпишіть свій код тут";var a=document.createElement("button");a.className="colorize rm",a.innerHTML="готово";var r=e.cloneNode();r.className="delete rm";var o=e.cloneNode();return o.className="plusA rm",t.appendChild(n),t.appendChild(a),e.appendChild(t),e.appendChild(r),e.appendChild(o),a.addEventListener("click",function(e){var t=e.target.previousElementSibling,n=t.textContent.match(/\/\/\s*(css|html|js)/)[1];switch(console.log(n),n){case"css":t.className="language-css";break;case"js":t.className="language-js";break;default:t.className="language-html"}var a=t.innerHTML.replace(/<br><\/br>/gi,"\r\n");console.log(a),t.innerHTML=a,Prism.highlightAll()},!1),e}function m(e){var t=document.createElement("div");t.className="container";var n=document.createElement("iframe");n.width=640,n.height=480,n.src=e,n.setAttribute("allowfullscreen",!0);var a=t.cloneNode();a.className="delete rm";var r=t.cloneNode();return r.className="plusA rm",t.appendChild(n),t.appendChild(a),t.appendChild(r),t}var p=document.getElementById("img"),g=document.getElementById("p"),h=document.getElementById("p-selected"),f=document.getElementById("code"),v=document.getElementById("video"),y=document.querySelectorAll(".pop-up")[0],N=document.querySelectorAll(".close-popup")[0],E=document.getElementById("urlInput");p.addEventListener("click",n,!1),g.addEventListener("click",r,!1),h.addEventListener("click",o,!1),f.addEventListener("click",s,!1),v.addEventListener("click",i,!1),a.show=function(){a.style.display="block",a.className="sub-menu appear"},a.hide=function(){a.className="sub-menu disappear",setTimeout(function(){a.style.display="none"},390)}}var a=document.querySelectorAll(".sub-menu")[0];return{init:n,elem:a}}),define("jsmodules/elements/pop-up-url",[],function(){var e=document.querySelectorAll(".pop-up")[0],t=document.querySelectorAll(".close-popup")[0];return{elem:e,ok:t}}),define("jsmodules/selectMenu",["require","./elements/pop-up-url","./elements/pop-up-url"],function(e){function t(){function t(e){if(window.getSelection)if(""!=window.getSelection().toString()){var t=window.getSelection().getRangeAt(0),a=n(t);l.style.top=a.y-66+"px",l.style.left=a.x+Math.round(a.width/2)-Math.round(d/2)+"px",l.show()}else l.hide()}function n(e){var t=e.getBoundingClientRect(),n=Math.round(t.left),a=Math.round(t.top),r=Math.round(t.right-n),o=Math.round(t.bottom-a);return{x:n,y:a,width:r,height:o}}function a(){document.execCommand("bold",!1),l.hide()}function r(){document.execCommand("italic",!1),l.hide()}function o(){var e=document.getSelection().getRangeAt(0);i.style.display="block",i.className="pop-up pop-up-appear";var t=document.getElementById("urlInput");t.focus(),l.hide(),s.onclick=function(t){i.className="pop-up pop-up-disappear",setTimeout(function(){i.style.display="none"},380);var n=urlInput.value,a=document.createElement("a");a.href=n,e.surroundContents(a)}}var s=e("./elements/pop-up-url").ok,i=e("./elements/pop-up-url").elem;console.dir(i);var l=document.getElementById("select-menu"),d=l.offsetWidth;l.style.display="none";for(var c=document.getElementsByTagName("p"),u=0;u<c.length;u++)c[u].addEventListener("mouseup",t,!1),c[u].addEventListener("keyup",t,!1),c[u].addEventListener("dblclick",t,!1);l.show=function(){l.style.display="block",l.className="appear"},l.hide=function(){l.className="disappear",setTimeout(function(){l.style.display="none"},190)};var m=document.getElementById("bold");m.addEventListener("click",a,!1);var p=document.getElementById("italic");p.addEventListener("click",r,!1);var g=document.getElementById("link");g.addEventListener("click",o,!1)}return t}),define("jsmodules/utils",[],function(){function e(e,t){var n=t.parentNode,a=t.nextSibling;return a?n.insertBefore(e,a):n.appendChild(e)}function t(e,t){if("string"==typeof t){var n=e.ownerDocument.createRange();n.setStartBefore(e),t=n.createContextualFragment(t);var a=e.cloneNode();a.innerHTML=e.innerHTML,t.firstElementChild.appendChild(a);var r=e.parentNode;r.replaceChild(t,e)}else{var a=e.cloneNode();a.innerHTML=e.innerHTML,t.appendChild(a);var r=e.parentNode;r.replaceChild(t,e)}}function n(e){var t=e.getBoundingClientRect(),n=document.body,a=document.documentElement,r=window.pageYOffset||a.scrollTop||n.scrollTop,o=window.pageXOffset||a.scrollLeft||n.scrollLeft,s=a.clientTop||n.clientTop||0,i=a.clientLeft||n.clientLeft||0,l=t.top+r-s,d=t.left+o-i;return{top:l,left:d}}function a(e,t){return e.className&&new RegExp("(\\s|^)"+t+"(\\s|$)").test(e.className)}function r(){for(var e=document.querySelectorAll(".rm"),t=0;t<e.length;t++)e[t].style.display="none"}function o(){for(var e=document.querySelectorAll(".rm"),t=0;t<e.length-1;t++)e[t].className+=" appear",e[t].style.display="block"}return"undefined"==typeof HTMLElement||HTMLElement.prototype.insertAdjacentElement||(HTMLElement.prototype.insertAdjacentElement=function(e,t){switch(e){case"beforeBegin":this.parentNode.insertBefore(t,this);break;case"afterBegin":this.insertBefore(t,this.firstChild);break;case"beforeEnd":this.appendChild(t);break;case"afterEnd":this.nextSibling?this.parentNode.insertBefore(t,this.nextSibling):this.parentNode.appendChild(t)}},HTMLElement.prototype.insertAdjacentHTML=function(e,t){var n=this.ownerDocument.createRange();n.setStartBefore(this);var a=n.createContextualFragment(t);this.insertAdjacentElement(e,a)},HTMLElement.prototype.insertAdjacentText=function(e,t){var n=document.createTextNode(t);this.insertAdjacentElement(e,n)}),{insertAfter:e,wrap:t,getOffset:n,hasClass:a,delControls:r,showControls:o}}),define("jsmodules/imgFunc/resizeImg",[],function(){function e(e,n){var a=new Image;a.src=e.src;var r=n/a.width*a.height;t.width=n,t.height=r,t.getContext("2d").drawImage(a,0,0,n,r);var o=t.toDataURL("image/jpeg",1);return e.setAttribute("src",o),o}var t=document.createElement("canvas");return e}),define("jsmodules/imgFunc/resize",["require","../utils","../utils"],function(e){function t(t,r){var o,s,i,l,d,c=new Image,u={},m=!1,p=60,g=60,h=800,f=900,v=function(){c.src=t.src,console.log("image"),console.log(c.src);var n=t.parentNode;s=document.createElement("div"),s.className="resize-handle resize-handle-nw",n.insertBefore(s,t),i=s.cloneNode(),s.className="resize-handle resize-handle-ne",n.insertBefore(i,s);var a=e("../utils").insertAfter;l=s.cloneNode(),l.className="resize-handle resize-handle-se",a(l,t),d=s.cloneNode(),d.className="resize-handle resize-handle-sw",a(d,l),o=n,console.log("container"),console.log(o),s.addEventListener("mousedown",startResize,!1),i.addEventListener("mousedown",startResize,!1),l.addEventListener("mousedown",startResize,!1),d.addEventListener("mousedown",startResize,!1)};startResize=function(e){e.preventDefault(),e.stopPropagation(),saveEventState(e),document.addEventListener("mousemove",resizing),document.addEventListener("mouseup",endResize)},endResize=function(e){e.preventDefault(),document.removeEventListener("mousemove",resizing);try{o.removeChild(s),o.removeChild(i),o.removeChild(l),o.removeChild(d)}catch(e){}r.style.display="block",r.nextElementSibling.style.display="block",r.previousElementSibling.previousElementSibling.style.display="block",r.previousElementSibling.previousElementSibling.previousElementSibling.style.display="block",r.previousElementSibling.previousElementSibling.previousElementSibling.previousElementSibling.style.display="block"},saveEventState=function(e){u.containerWidth=o.offsetWidth,u.containerHeight=o.offsetHeight;var t=a(o);u.containerLeft=t.left,u.containerTop=t.top,u.mouseX=(e.clientX||e.pageX||e.originalEvent.touches[0].clientX)+window.pageXOffset,u.mouseY=(e.clientY||e.pageY||e.originalEvent.touches[0].clientY)+window.pageYOffset,"undefined"!=typeof e.touches&&(u.touches=[],$.each(e.originalEvent.touches,function(e,t){u.touches[e]={},u.touches[e].clientX=0+t.clientX,u.touches[e].clientY=0+t.clientY})),u.evnt=e},resizing=function(e){var t,n,r,s,i={};a(o);i.x=(e.clientX||e.pageX||e.originalEvent.touches[0].clientX)+window.pageXOffset,i.y=(e.clientY||e.pageY||e.originalEvent.touches[0].clientY)+window.pageYOffset,/resize-handle-se/.test(u.evnt.target.className)?(t=i.x-u.containerLeft,n=i.y-u.containerTop,r=u.containerLeft,s=u.containerTop):/resize-handle-sw/.test(u.evnt.target.className)?(t=u.containerWidth-(i.x-u.containerLeft),n=i.y-u.containerTop,r=i.x,s=u.containerTop):/resize-handle-nw/.test(u.evnt.target.className)?(t=u.containerWidth-(i.x-u.containerLeft),n=u.containerHeight-(i.y-u.containerTop),r=i.x,s=i.y,(m||e.shiftKey)&&(s=i.y-(t/orig_src.width*orig_src.height-n))):/resize-handle-ne/.test(u.evnt.target.className)&&(t=i.x-u.containerLeft,n=u.containerHeight-(i.y-u.containerTop),r=u.containerLeft,s=i.y,(m||e.shiftKey)&&(s=i.y-(t/c.width*c.height-n))),(m||e.shiftKey)&&(n=t/c.width*c.height),t>p&&n>g&&h>t&&f>n&&resizeImage(t,n)},resizeImage=function(e,a){n.width=e,n.height=a,n.getContext("2d").drawImage(c,0,0,e,a),t.setAttribute("src",n.toDataURL("image/jpeg",1))},v()}var n=document.createElement("canvas"),a=e("../utils").getOffset;return t}),define("jsmodules/ajax/ajax",[],function(){function e(e,t){r++,xhr=new XMLHttpRequest,xhr.open("POST","/newArticle",!0),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.setRequestHeader("Content-type","application/json; charset=utf-8"),e=JSON.stringify(e),xhr.send(e),xhr.onreadystatechange=function(){return 4==xhr.readyState?200==xhr.status?(console.log(xhr.responseText),o.push(1),console.log("sended html data"),!0):void console.log(xhr.status+": "+xhr.statusText):void 0}}function t(e,t){r++,xhr=new XMLHttpRequest,xhr.open("POST","/updateArticle",!0),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.setRequestHeader("Content-type","application/json; charset=utf-8"),e=JSON.stringify(e),xhr.send(e),xhr.onreadystatechange=function(){return 4==xhr.readyState?200==xhr.status?(console.log(xhr.responseText),o.push(1),console.log("updateHTML"),!0):void console.log(xhr.status+": "+xhr.statusText):void 0}}function n(e,t,n){r++,xhr=new XMLHttpRequest;var a=t;xhr.open("POST","/base64",!0),console.log("sending: "+a),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.setRequestHeader("Content-type","application/json; charset=utf-8"),e=JSON.stringify({image:e,name:t}),xhr.send(e),xhr.onload=xhr.onerror=function(){200==this.status?(console.log(xhr.responseText),o.push(1)):console.log(xhr.status+": "+xhr.statusText)}}function a(e,t){xhr=new XMLHttpRequest,xhr.open("POST","/removeArticle/"+e,!0),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.setRequestHeader("Content-type","application/json; charset=utf-8"),xhr.send(),xhr.onreadystatechange=function(){return 4==xhr.readyState?200==xhr.status?(console.log(xhr.responseText),t.className="fullScreen disappear",setTimeout(function(){t.style.display="none"},390),!0):void console.log(xhr.status+": "+xhr.statusText):void 0}}var r=0,o=[];return{sendHTML:e,updateHTML:t,sendBase64:n,removeArticle:a,numOfcall:r,ok:o}});var numOfcall=0,ok=[];define("newArticle",["require","jsmodules/subMenu","jsmodules/subMenu","jsmodules/selectMenu","jsmodules/utils","jsmodules/imgFunc/addImage","jsmodules/imgFunc/resizeImg","jsmodules/imgFunc/resize","jsmodules/ajax/ajax","jsmodules/utils"],function(e){function t(){function t(t){var r=t.target;if(t.preventDefault(),"p"!=r.tagName.toLowerCase()&&"h1"!=r.tagName.toLowerCase()||(r.setAttribute("contenteditable","true"),r.focus(),r.onkeydown=function(e){return 13==e.keyCode?!1:void 0},r.onkeyup=function(e){return 13==e.keyCode?!1:void 0}),o(r,"addBanner")){var l=r.previousElementSibling,d=r.parentNode;s(l,i)}if(o(r,"arrLeft")){var d=r.parentNode;d.className="img-container left"}if(o(r,"arrCenter")){var d=r.parentNode,c=d.parentNode;n.insertBefore(d,c)}if(o(r,"arrRight")){var d=r.parentNode;d.className="img-container right"}if(o(r,"add")){var l=r.previousElementSibling.previousElementSibling;s(l)}if(o(r,"resize")){r.style.display="none",r.nextElementSibling.style.display="none",r.previousElementSibling.previousElementSibling.previousElementSibling.previousElementSibling.style.display="none",r.previousElementSibling.previousElementSibling.previousElementSibling.style.display="none",r.previousElementSibling.previousElementSibling.style.display="none";var u=e("jsmodules/imgFunc/resize");u(r.previousElementSibling,r)}if(o(r,"delete")){var d=r.parentNode;d.parentNode.removeChild(d)}o(r,"plusA")&&(!r.firstChild||/disappear/.test(a.className)?(r.appendChild(a),a.show()):/appear/.test(a.className)&&a.hide())}var n=document.querySelectorAll(".flex-wrapper")[0];n.addEventListener("click",t,!1);var a=e("jsmodules/subMenu").elem;e("jsmodules/subMenu").init();var r=e("jsmodules/selectMenu");r();var o=e("jsmodules/utils").hasClass,s=e("jsmodules/imgFunc/addImage"),i=e("jsmodules/imgFunc/resizeImg");document.getElementById("save");save.onclick=function(){var t=e("jsmodules/ajax/ajax"),a=e("jsmodules/utils").delControls;a();var r=(document.getElementById("prog"),document.querySelectorAll(".fullScreen")[0]);r.style.display="block",r.className="fullScreen appear";var o=document.getElementsByTagName("img"),s=document.getElementById("bn");if(s){var l=s.src,d=i(s,300),c="small"+s.getAttribute("data-name");s.src=l,t.sendBase64(d,c,r)}if(o)for(var u=0;u<o.length;u++){var m=o[u].src,p=o[u].getAttribute("data-name");o[u].src="/loaded/"+p,t.sendBase64(m,p,r)}var g=document.getElementsByTagName("h1")[0];g.removeAttribute("contenteditable");for(var h=document.getElementsByTagName("p"),u=0;u<h.length;u++)h[u].hasAttribute("contenteditable")&&h[u].removeAttribute("contenteditable");for(var f=document.getElementsByTagName("code"),u=0;u<f.length;u++)f[u].hasAttribute("contenteditable")&&f[u].removeAttribute("contenteditable");var v=document.getElementsByTagName("h1")[0].innerHTML,y=n.innerHTML,N=document.getElementsByTagName("p")[0].innerHTML;t.sendHTML({title:v,body:y,desc:N,banner:c},r),console.log(ok),console.log(numOfcall);var E=setInterval(function(){ok.length==numOfcall&&(clearInterval(E),r.className="fullScreen disappear",setTimeout(function(){r.style.display="none",window.location="/"},390))},1e3)}}window.addEventListener("load",t,!1),document.execCommand("insertBrOnReturn",!1,!1)});